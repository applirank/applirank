name: ğŸ›¡ï¸ AI Vibe Check (PR Safety)

on:
  pull_request:
    branches:
      - main # Runs whenever you try to merge into main

jobs:
  validate:
    name: ğŸ•µï¸ Test & Build
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Download the Code
        uses: actions/checkout@v4

      - name: ğŸŸ¢ Set up Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20' # Uses modern Node.js
          cache: 'npm' # Speeds up installations

      - name: ğŸ“¦ Install Dependencies
        run: npm ci # Installs exactly what is in package-lock.json

      # 1. Catch AI hallucinations (fake variables, bad types)
      - name: ğŸ” Type Check (Nuxt & TypeScript)
        run: npx nuxi typecheck

      # 2. Catch Drizzle Database errors
      - name: ğŸ—„ï¸ Check Database Schema (Drizzle)
        # This checks if your schema.ts matches your migrations
        run: npx drizzle-kit check

      # 3. Catch general crashes before Railway sees it
      - name: ğŸ—ï¸ Build Application
        run: npx nuxi build